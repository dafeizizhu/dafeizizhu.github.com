!function(t){function n(r){if(i[r])return i[r].exports;var a=i[r]={exports:{},id:r,loaded:!1};return t[r].call(a.exports,a,a.exports,n),a.loaded=!0,a.exports}var r=window["webpackJsonp"];window["webpackJsonp"]=function(i,o){for(var s,u,c=0,f=[];c<i.length;c++)u=i[c],a[u]&&f.push.apply(f,a[u]),a[u]=0;for(s in o)Object.prototype.hasOwnProperty.call(o,s)&&(t[s]=o[s]);for(r&&r(i,o);f.length;)f.shift().call(null,n)};var i={},a={0:0};return n.e=function(t,r){if(0===a[t])return r.call(null,n);if(void 0!==a[t])a[t].push(r);else{a[t]=[r];var i=document.getElementsByTagName("head")[0],o=document.createElement("script");o.type="text/javascript",o.charset="utf-8",o.async=!0,o.src=n.p+""+t+"."+({}[t]||t)+".js",i.appendChild(o)}},n.m=t,n.c=i,n.p="",n(0)}([function(t,n,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var a=r(1),o=i(a),s=r(7),u=i(s),c=(r(13),r(8),r(9),r(14)),f=i(c);(0,o.default)(function(t,n){n(function(){var t=n("#t"),r=n("#s_t");new u.default;r.on("click",function(){c(),m()});var i,a,o,s=new f.default,c=function(){l()},l=function(){var t;t=new MediaSource,t.video=o,o.ms=t,t.addEventListener("sourceopen",p),t.addEventListener("sourceclose",d),o.src=window.URL.createObjectURL(t),o.onloadedmetadata=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return console.log(["loadedmetadata"].concat(n))},o.onplaying=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return console.log(["playing"].concat(n))},o.onplay=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return console.log(["play"].concat(n))},o.onabort=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return console.log(["abort"].concat(n))},o.oncanplay=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return console.log(["canplay"].concat(n))},o.oncanplaythrough=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return console.log(["canplaythrough"].concat(n))},o.onended=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return console.log(["ended"].concat(n))},o.onloadeddata=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return console.log(["loadeddata"].concat(n))},o.onloadstart=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return console.log(["loadstart"].concat(n))},o.onpause=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return console.log(["pause"].concat(n))},o.onprogress=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return console.log(["progress"].concat(n))},o.onseeked=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return console.log(["seeked"].concat(n))},o.onseeking=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return console.log(["seeking"].concat(n))},o.onstalled=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return console.log(["stalled"].concat(n))},o.onwaiting=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return console.log(["waiting"].concat(n))}},p=function(){},d=function(){},m=function(){o.play(),setTimeout(h,1e3)},h=function(){var n=o.ms;"open"==n.readyState&&(i=new u.default,i.onReady=function(t){console.log(t),a=t,n.duration=t.duration/t.timescale,g()},i.onFragment=function(t,n,r,i){var a=n;a.appends.push({buffer:r}),b({target:a})},s.setCallback(function(t,n,r){var a=0;return t&&(a=i.append(new Uint8Array(t))),s.stop()}),s.setInterval(500),s.setChunkSize(10485760),s.setUrl(t.val()),s.start())},g=function(){if(a){for(var t=0;t<a.tracks.length;t++){var n=a.tracks[t];v(o,n)}y()}},v=function(t,n){var r,a=t.ms,o=n.id,s=n.codec,u='video/mp4; codecs="'+s+'"';if(MediaSource.isTypeSupported(u))try{r=a.addSourceBuffer(u),r.track_id=o,r.addEventListener("error",function(e){return console.log("MSE SourceBuffer #"+o,e,r)}),r.ms=a,r.id=o,i.setSegmentOptions(o,r,{nbSamples:1e3}),r.pendingAppends=[]}catch(e){console.log("MES SourceBuffer #"+o,"Cannot create buffer with type",u,e)}},y=function(){for(var t=i.initializeSegmentation(),n=0;n<t.length;n++){var r=t[n].user;0==n&&(r.ms.pendingInits=0),r.addEventListener("updateend",_),r.appendBuffer(t[n].buffer),r.segmentIndex=0,r.ms.pendingInits++,r.appends=[]}},_=function A(t){var n=t.target;"open"==n.ms.readyState&&(n.removeEventListener("updateend",A),n.addEventListener("updateend",b),b({target:n}))},b=function S(t){var n=t.target;if("open"==n.ms.readyState&&!n.updating&&n.appends.length){var r=n.appends.shift();n.appendBuffer(r.buffer),n.appends.length||(n.removeEventListener("updateend",S),n.addEventListener("updateend",w))}},w=function(t){};o=document.getElementById("v"),c(),m()})})},function(t,n,r){(function(t){"use strict";n.__esModule=!0;var i=r(2),a=(0,i.getLogger)("utils/ensuer-zepto"),o=null,s=function(n){o?setTimeout(function(){return n(null,o)},0):t.$&&"function"==typeof t.$.ajax?(a.debug("using global zepto/jquery"),o=t.$,setTimeout(function(){return n(null,o)},0)):"function"==typeof getComputedStyle?(a.debug("using local zepto"),r.e(1,function(t){o=r(4),n(null,o)})):(a.warn("browser not support zepto"),setTimeout(function(){return n(new Error("getComputedStyle is not defined"))},0))};n.default=s}).call(n,function(){return this}())},function(t,n,r){"use strict";var i=r(3);console||(console={}),console.log||(console.log=function(){}),n.getLogger=function(t){return{debug:function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r]},info:function(){for(var n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];try{console.log.apply(console,["["+i()+"][INFO] - "+t].concat(r))}catch(e){console.log(["["+i()+"][INFO] - "+t].concat(r).join(" "))}},warn:function(){for(var n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];try{console.log.apply(console,["["+i()+"][WARN] - "+t].concat(r))}catch(e){console.log(["["+i()+"][WARN] - "+t].concat(r).join(" "))}}}}},function(t,n){"use strict";function r(t,n){for(var r=t.toString();r.length<n;)r="0"+r;return r}function i(t){return r(t,2)}function a(t){var n=Math.abs(t),r=String(Math.floor(n/60)),i=String(n%60);return 1===r.length&&(r="0"+r),1===i.length&&(i="0"+i),t<0?"+"+r+i:"-"+r+i}function o(n,o,s){"string"!=typeof n&&(s=o,o=n,n=t.exports.ISO8601_FORMAT),o||(o=new Date),void 0===s&&(s=o.getTimezoneOffset()),o.setUTCMinutes(o.getUTCMinutes()-s);var u=i(o.getUTCDate()),c=i(o.getUTCMonth()+1),f=i(o.getUTCFullYear()),l=i(o.getUTCFullYear().toString().substring(2,4)),p=n.indexOf("yyyy")>-1?f:l,d=i(o.getUTCHours()),m=i(o.getUTCMinutes()),h=i(o.getUTCSeconds()),g=r(o.getUTCMilliseconds(),3),v=a(s);o.setUTCMinutes(o.getUTCMinutes()+s);var y=n.replace(/dd/g,u).replace(/MM/g,c).replace(/y{1,4}/g,p).replace(/hh/g,d).replace(/mm/g,m).replace(/ss/g,h).replace(/SSS/g,g).replace(/O/g,v);return y}t.exports=o,t.exports.asString=o,t.exports.ISO8601_FORMAT="yyyy-MM-dd hh:mm:ss.SSS",t.exports.ISO8601_WITH_TZ_OFFSET_FORMAT="yyyy-MM-ddThh:mm:ss.SSSO",t.exports.DATETIME_FORMAT="dd MM yyyy hh:mm:ss.SSS",t.exports.ABSOLUTETIME_FORMAT="hh:mm:ss.SSS"},,,,function(t,n,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function a(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}n.__esModule=!0;var o=(r(8),r(9)),s=r(10),u=r(11),c=i(u),f=r(12),l=i(f),p=function(t,n){for(var r=t.toString(16),n="undefined"==typeof n||null==pading?2:n;r.length<n;)r="0"+r;return r},d=function(t){var n=t.type.replace(".","");try{if("avc1"==t.type){var r=t.boxes.filter(function(t){return"avcC"==t.type})[0];return n+"."+p(r.AVCProfileIndication)+p(r.profile_compatibility)+p(r.AVCLevelIndication)}if("mp4a"==t.type){var i=t.boxes.filter(function(t){return"esds"==t.type})[0],a=i.descriptors.filter(function(t){return 3==t.tag})[0].descriptors.filter(function(t){return 4==t.tag})[0].oti,o=null,s=i.descriptors.filter(function(t){return 3==t.tag})[0].descriptors.filter(function(t){return 4==t.tag})[0].descriptors.filter(function(t){return 5==t.tag})[0];return s&&(o=(248&s.data[0])>>3),n+"."+p(a)+(o?"."+o:"")}return n}catch(e){return console.warn(e),n}},m=function(t){var n,r,i,a,o,s,u,c,f,l,p,d=[],m=0,h=0,g=t.mdia.minf.stbl,v=g.stco,y=g.stsc,_=g.stsz,b=g.stts,w=g.ctts,A=g.stss,S=g.stsd,k=g.subs,x=g.stdp,U=g.sbgp,L=g.sgpd;if(u=-1,c=-1,f=-1,l=-1,p=0,U||L)throw new Error("stbl contain sbgp or sgpd is not implemented");if(_){for(n=0;n<_.sample_count;n++){var z={};if(z.number=n,z.track_id=t.tkhd.track_ID,z.timescale=t.mdia.mdhd.timescale,z.alreadyRead=0,d.push(z),z.size=_.samples[n].entry_size,h+=z.size,0==n?(i=1,r=0,z.chunk_index=i,z.chunk_run_index=r,s=y.entries[r].samples_per_chunk,o=0,a=r+1<y.entries.length?y.entries[r+1].first_chunk-1:1/0):n<s?(z.chunk_index=i,z.chunk_run_index=r):(i+=1,z.chunk_index=i,o=0,i<=a||(r+=1,a=r+1<y.entries.length?y.entries[r+1].first_chunk-1:1/0),z.chunk_run_index=r,s+=y.entries[r].samples_per_chunk),z.description_index=y.entries[z.chunk_run_index].sample_description_index-1,z.description=S.entries[z.description_index],z.offset=v.entries[z.chunk_index-1].chunk_offset+o,o+=z.size,n>u&&(c+=1,u<0&&(u=0),u+=b.entries[c].sample_count),n>0?(d[n-1].duration=b.entries[c].sample_delta,m+=d[n-1].duration,z.dts=d[n-1].dts+d[n-1].duration):z.dts=0,w?(n>=f&&(l+=1,f<0&&(f=0),f+=w.entries[l].sample_count),z.cts=d[n].dts+w.entries[l].sample_offset):z.cts=z.dts,A?p<A.entry_count&&n==A.entries[p].sample_number-1?(z.is_sync=!0,p+=1):z.is_sync=!1:z.is_sync=!0,x)throw new Error("stbl contain stdp is not implemented");if(k)throw new Error("stbl contain subs is not implemented");if(U)throw new Error("stbl contain sbgp is not implemented");if(L)throw new Error("stbl contain sgpd is not implemented")}n>0&&(d[n-1].duration=Math.max(t.mdia.mdhd.duration-d[n-1].dts,0),m+=d[n-1].duration)}return{samples:d,samples_duration:m,samples_size:h}},h=function(){function t(){a(this,t),this.data=new Uint8Array,this.position=0,this.boxes={},this.info=null,this.readySize=0,this.fragmentedTracks=[],this.nextMoofNumber=0}return t.prototype.append=function(t){var n=this,r=new Uint8Array(this.data.length+t.length);if(r.set(this.data,0),r.set(t,this.data.byteLength),this.data=r,!(this.data.length-this.position<8)){if(!this.ready)do{var i=(0,o.uint32)(this.data,this.position),a=(0,o.str)(this.data,this.position+4,4);if("moov"==a&&(this.readySize=this.position+i),!(this.position+i<=this.data.byteLength))break;c.default["parse_"+a]?this.boxes[a]=c.default["parse_"+a](this.data.subarray(this.position,this.position+i)):this.boxes[a]=c.default.parse_unknow(this.data.subarray(this.position,this.position+i)),"moov"==a&&(console.log("ready",this.boxes),this.ready=!0,"function"==typeof this.onReady&&this.onReady(this.getInfo())),this.position+=i}while(this.position<this.data.byteLength-4);return this.ready&&this.info.tracks.forEach(function(r,i){for(;r.nextSample<r.samples.length;){var a=r.nextSample,o=r.samples,u=r.id,c=o[a];if(!(n.data.byteLength>=c.offset+c.size)){console.log("not enough data, require",c.offset+c.size,", actual",t.byteLength);break}c.data=new Uint8Array(c.size),c.data.set(n.data.subarray(c.offset,c.offset+c.size),0);var f={version:0,flag:new Uint8Array([0,0,0]),sequence_number:n.nextMoofNumber};n.nextMoofNumber+=1;var p={version:0,flag:new Uint8Array([2,0,0]),track_ID:u},d={version:0,flag:new Uint8Array([0,0,0]),baseMediaDecodeTime:c.dts},m={version:0,flag:new Uint8Array([0,15,1]),sample_count:1,data_offset:108,first_sample_flags:0,samples:[{sample_duration:c.duration,sample_size:c.size,sample_flags:0,sample_composition_time_offset:c.cts-c.dts}]},h=l.default.box("moof",l.default.mfhd(f),l.default.box("traf",l.default.tfhd(p),l.default.tfdt(d),l.default.trun(m))),g=l.default.box("mdat",c.data);if(n.onFragment){var v=n.fragmentedTracks[i];n.onFragment(1,v.user,(0,s.join)(h,g),a)}r.nextSample=a+1}}),this.data.byteLength}},t.prototype.getInfo=function(){if(this.info)return this.info;var t=[],n=function(t){var n=t.mdia.minf.stbl.stsd.entries[0],r=m(t),i=r.samples,a=r.samples_duration,o=r.samples_size;return{sample_des:n,id:t.tkhd.track_ID,name:t.mdia.hdlr.name,edits:t.edts?t.edts.elst.entries:null,codec:d(n),samples:i,samples_duration:a,samples_size:o,nextSample:0}};if(this.boxes.moov.trak instanceof Array)for(var r=0;r<this.boxes.moov.trak.length;r++)t.push(n(this.boxes.moov.trak[r]));else t.push(n(this.boxes.moov.trak));return this.info={duration:this.boxes.moov.mvhd.duration,timescale:this.boxes.moov.mvhd.timescale,tracks:t},this.info},t.prototype.getTrakById=function(t){var n=this.boxes.moov.trak instanceof Array?this.boxes.moov.trak:[this.boxes.moov.trak],r=n.filter(function(n){return n.tkhd.track_ID==t})[0];return r},t.prototype.setSegmentOptions=function(t,n,r){var i=this.getTrakById(t);if(i){var a={};this.fragmentedTracks.push(a),a.id=t,a.user=n,a.trak=i,i.nextSample=0,a.segmentStream=null,a.nb_samples=1e3,a.rapAlignment=!0}},t.prototype.initializeSegmentation=function(){var t,n,r,i;for(this.isFragmentationInitialized||(this.isFragmentationInitialized=!0,this.nextMoofNumber=0),n=[],t=0;t<this.fragmentedTracks.length;t++){var i={},r=this.fragmentedTracks[t].trak;i.id=this.fragmentedTracks[t].id,i.user=this.fragmentedTracks[t].user;var a=(0,s.join)(l.default.ftyp(this.boxes.ftyp),l.default.box("moov",l.default.mvhd(Object.assign({},this.boxes.moov.mvhd,{duration:0})),l.default.box("trak",l.default.tkhd(Object.assign({},r.tkhd,{duration:0})),l.default.box("edts",l.default.elst(r.edts.elst)),l.default.box("mdia",l.default.mdhd(Object.assign({},r.mdia.mdhd,{duration:0})),l.default.hdlr(r.mdia.hdlr),l.default.box("minf",r.mdia.minf.vmhd?l.default.vmhd(r.mdia.minf.vmhd):l.default.smhd(r.mdia.minf.smhd),l.default.box("dinf",l.default.dref(r.mdia.minf.dinf.dref)),l.default.box("stbl",l.default.stsd(r.mdia.minf.stbl.stsd),l.default.stts(Object.assign({},r.mdia.minf.stbl.stts,{entry_count:0,entries:[]})),r.mdia.minf.stbl.ctts?l.default.ctts(Object.assign({},r.mdia.minf.stbl.ctts,{entry_count:0,entries:[]})):new Uint8Array(0),l.default.stsc(Object.assign({},r.mdia.minf.stbl.stsc,{entry_count:0,entries:[]})),l.default.stsz(Object.assign({},r.mdia.minf.stbl.stsz,{sample_count:0,samples:[]})),l.default.stco(Object.assign({},r.mdia.minf.stbl.stco,{entry_count:0,entries:[]})))))),l.default.box("mvex",l.default.trex({version:0,flag:new Uint8Array([0,0,0]),track_ID:r.tkhd.track_ID,default_sample_description_index:1,default_sample_duration:this.info.tracks[t].samples[0].duration,default_sample_size:0,default_sample_flags:65536}))));i.buffer=a.buffer,n.push(i)}return n},t}();n.default=h},function(t,n){"use strict";n.binary=function(t){var n,i=[];for(n=0;n<t.length;n++){for(var a=t[n].toString(2);a.length<8;)a="0"+a;i.push(a)}return r(i)},n.hex=function(t,n){var i,a=[];for(i=0;i<t.length;i++){for(var o=t[i].toString(16);o.length<2;)o="0"+o;a.push("0x"+o)}return r(a,n)};var r=function(t,n){var n=n||" ",r=t.length,i=String(r).length%2?String(r).length+1:String(r).length;return t.map(function(t,r){if(r%8==0){for(var a=String(r);a.length<i;)a=" "+a;return a+"  "+t+n+" "}return r%8==7?t+n+"\n":t+n+" "}).join("")}},function(t,n){"use strict";n.bits=function(t,n,r){for(var i,a=0;a<8;a++)i=a<n||a>=n+r?i?i<<1|0:0:i?i<<1|1:1;return(t&i)>>>8-n-r},n.uint32=function(t,n){return new DataView(t.buffer,t.byteOffset+n).getUint32()},n.int32=function(t,n){return new DataView(t.buffer,t.byteOffset+n).getInt32()},n.uint16=function(t,n){return new DataView(t.buffer,t.byteOffset+n).getUint16()},n.int16=function(t,n){return new DataView(t.buffer,t.byteOffset+n).getInt16()},n.uint8=function(t,n){return new DataView(t.buffer,t.byteOffset+n).getUint8()},n.int8=function(t,n){return new DataView(t.buffer,t.byteOffset+n).getInt8()},n.str=function(t,n,r){return String.fromCharCode.apply(null,t.subarray(n,n+r))}},function(t,n){"use strict";n.join=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=n.map(function(t){return t.byteLength||0}).reduce(function(t,n){return t+n},0),a=new ArrayBuffer(i),o=new Uint8Array(a),s=0;return n.forEach(function(t){t.byteLength&&(o.set(t,s),s+=t.byteLength)}),o},n.ascii_string=function(t,n){for(var n=isNaN(n)?t.length:n,r=new ArrayBuffer(n),i=new DataView(r),a=0;a<n;a++)i.setUint8(a,t.charCodeAt(a)%256);return new Uint8Array(r)},n.uint32=function(t){var n=new ArrayBuffer(4),r=new DataView(n);return r.setUint32(0,t),new Uint8Array(n)},n.int16=function(t){var n=new ArrayBuffer(2),r=new DataView(n);return r.setInt16(0,t),new Uint8Array(n)},n.int32=function(t){var n=new ArrayBuffer(4),r=new DataView(n);return r.setInt32(0,t),new Uint8Array(n)},n.uint16=function(t){var n=new ArrayBuffer(2),r=new DataView(n);return r.setUint16(0,t),new Uint8Array(n)},n.uint8=function(t){var n=new ArrayBuffer(1),r=new DataView(n);return r.setUint8(0,t),new Uint8Array(n)}},function(t,n,r){"use strict";var i=r(8),a=r(9),o=function(t,n){var n=n||0,r=(0,a.uint32)(t,n);n+=4;var i=(0,a.str)(t,n,4);return n+=4,{size:r,type:i,position:n}},s=function(t,n){for(var r={};n<t.byteLength;){var i=o(t,n),a=i.type,s=i.size,u=Y["parse_"+a]?Y["parse_"+a]:Y.parse_unknow;r[a]?(r[a]=[r[a]],r[a].push(u(t.subarray(n,n+s)))):r[a]=u(t.subarray(n,n+s)),n+=s}return r},u=function(t,n){var r=0;for(var i in n)n[i].type&&n[i].size?(t[i]=n[i],r+=n[i].size):n[i]instanceof Array&&(t[i]=n[i],r+=n[i].map(function(t){return t.size||0}).reduce(function(t,n){return t+n}));return r},c=function(t){var n=o(t),r=n.position,i=u(n,s(t,r));return n.position+=i,n},f=function(t){var n=o(t),r=n.position;return n.version=(0,a.uint8)(t,r),r+=1,n.flag=new Uint8Array(3),n.flag.set(t.subarray(r,r+3),0),r+=3,n.position=r,n},l=function(t){var n=o(t),r=n.position;return r+=6,n.data_reference_index=(0,a.uint16)(t,r),r+=2,n.position=r,n},p=function(t){var n=l(t),r=n.position;if(r+=2,r+=2,r+=12,n.width=(0,a.int16)(t,r),r+=2,n.height=(0,a.int16)(t,r),r+=2,n.horizresolution=(0,a.uint32)(t,r),r+=4,n.vertresolution=(0,a.uint32)(t,r),r+=4,r+=4,n.frame_count=(0,a.uint16)(t,r),r+=2,n.compressorname=(0,a.str)(t,r,32),r+=32,n.depth=(0,a.uint16)(t,r),r+=2,r+=2,r<n.size){var i=s(t,r);n.boxes=Object.keys(i).map(function(t){return i[t]}),r+=n.boxes.map(function(t){return t.size}).reduce(function(t,n){return t+n},0)}return n.position=r,n},d=function(t){var n=l(t),r=n.position;if(r+=8,n.channelcount=(0,a.uint16)(t,r),r+=2,n.samplesize=(0,a.uint16)(t,r),r+=2,r+=2,r+=2,n.samplereate=(0,a.uint32)(t,r),r+=4,r<n.size){var i=s(t,r);n.boxes=Object.keys(i).map(function(t){return i[t]}),r+=n.boxes.map(function(t){return t.size}).reduce(function(t,n){return t+n},0)}return n.position=r,n},m=function(t){var n=o(t);return console.warn(n.type,"is not implemented, skipped"),n.data=new Uint8Array(n.size-8),n.data.set(t.subarray(8,t.byteLength),0),n.position=t.byteLength,n},h=function(t){var n=o(t),r=n.position;n.major_brand=(0,a.str)(t,r,4),n.minor_version=(0,a.uint32)(t,r+4),n.compatible_brands=[];for(var i=r+8;i<t.byteLength;i+=4)n.compatible_brands.push((0,a.str)(t,i,4));return n.position=r,n},g=function(t){return c(t)},v=function(t){var n=f(t),r=12;if(0!=n.version)throw new Error("version equal to 1 is not implemented");return n.create_time=(0,a.uint32)(t,r),r+=4,n.modification_time=(0,a.uint32)(t,r),r+=4,n.timescale=(0,a.uint32)(t,r),r+=4,n.duration=(0,a.uint32)(t,r),r+=4,n.rate=parseFloat((0,a.uint16)(t,r)+"."+(0,a.uint16)(t,r+2)),r+=4,n.volume=parseFloat((0,a.uint8)(t,r)+"."+(0,a.uint8)(t,r+1)),r+=2,r+=2,r+=8,n.matrix=new Uint8Array(36),n.matrix.set(t.subarray(r,r+36),0),r+=36,r+=24,n.next_track_ID=(0,a.uint32)(t,r),r+=4,n.position=r,n},y=function(t){return c(t)},_=function(t){var n=f(t),r=n.position;if(0!=n.version)throw new Error("version equal to 1 is not implemented");return n.create_time=(0,a.uint32)(t,r),r+=4,n.modification_time=(0,a.uint32)(t,r),r+=4,n.track_ID=(0,a.uint32)(t,r),r+=4,r+=4,n.duration=(0,a.uint32)(t,r),r+=4,r+=8,n.layer=(0,a.int16)(t,r),r+=2,n.alternate_group=(0,a.int16)(t,r),r+=2,n.volume=parseFloat((0,a.uint8)(t,r)+"."+(0,a.uint8)(t,r+1)),r+=2,n.matrix=new Uint8Array(36),n.matrix.set(t.subarray(r,r+36),0),r+=36,n.width=(0,a.uint32)(t,r),r+=4,n.height=(0,a.uint32)(t,r),r+=4,n.position=r,n},b=function(t){return c(t)},w=function(t){var n=f(t),r=n.position;n.entry_count=(0,a.uint32)(t,r),r+=4,n.entries=[];for(var i=0;i<n.entry_count;i++){var o,s;if(0!=n.version)throw new Error("version equal to 1 is not implemented");o=(0,a.uint32)(t,r),r+=4,s=(0,a.int32)(t,r),r+=4;var u=(0,a.int16)(t,r);r+=2;var c=(0,a.int16)(t,r);r+=2,n.entries.push({segment_duration:o,media_time:s,media_rate_integer:u,media_rate_fraction:c})}return n.position=r,n},A=function(t){return c(t)},S=function(t){var n=f(t),r=n.position;if(0!=n.version)throw new Error("version equal to 1 is not implemented");return n.create_time=(0,a.uint32)(t,r),r+=4,n.modification_time=(0,a.uint32)(t,r),r+=4,n.timescale=(0,a.uint32)(t,r),r+=4,n.duration=(0,a.uint32)(t,r),r+=4,r+=4,n.position=r,n},k=function(t){var n=f(t),r=n.position;return r+=4,n.handler_type=(0,a.str)(t,r,4),r+=4,r+=12,n.name=(0,a.str)(t,r,t.byteLength-r),r+=n.name.length,n.position=r,n},x=function(t){return c(t)},U=function(t){return c(t)},L=function(t){var n=f(t),r=n.position;n.entry_count=(0,a.uint32)(t,r),r+=4,n.entries=[];for(var i=0;i<n.entry_count;i++){var s=o(t,r),u=s.type.trim(),c=s.size,l=Y["parse_"+u]?Y["parse_"+u]:m;n.entries.push(l(t.subarray(r,r+c))),r+=s.size}return n.position=r,n},z=function(t){var n=p(t);return n},T=function(t){var n=o(t),r=n.position;n.configurationVersion=(0,a.uint8)(t,r),r+=1,n.AVCProfileIndication=(0,a.uint8)(t,r),r+=1,n.profile_compatibility=(0,a.uint8)(t,r),r+=1,n.AVCLevelIndication=(0,a.uint8)(t,r),r+=1,n.lengthSizeMinusOne=3&(0,a.uint8)(t,r),r+=1,n.numOfSequenceParameterSets=31&(0,a.uint8)(t,r),r+=1,n.sequenceParameterSets=[];for(var i=0;i<n.numOfSequenceParameterSets;i++){var s={};s.sequenceParameterSetLength=(0,a.uint16)(t,r),r+=2,s.sequenceParameterSetNALUnit=new Uint8Array(s.sequenceParameterSetLength),s.sequenceParameterSetNALUnit.set(t.subarray(r,r+s.sequenceParameterSetLength),0),n.sequenceParameterSets.push(s),r+=s.sequenceParameterSetLength}n.numOfPictureParameterSets=(0,a.uint8)(t,r),r+=1,n.pictureParameterSets=[];for(var i=0;i<n.numOfPictureParameterSets;i++){var u={};u.pictureParameterSetLength=(0,a.uint16)(t,r),r+=2,u.pictureParameterSetNALUnit=new Uint8Array(u.pictureParameterSetLength),u.pictureParameterSetNALUnit.set(t.subarray(r,r+u.pictureParameterSetLength),0),n.pictureParameterSets.push(u),r+=u.pictureParameterSetLength}return n.position=r,n},j=function(t){var n=f(t),r=n.position;n.graphicsmode=(0,a.uint16)(t,r),r+=2,n.opcolor=[];for(var i=0;i<3;i++)n.opcolor.push((0,a.uint16)(t,r)),r+=2;return n.position=r,n},D=function(t){return c(t)},E=function(t){var n=f(t),r=n.position;n.entry_count=(0,a.uint32)(t,r),r+=4,n.entries=[];for(var i=0;i<n.entry_count;i++){var s=o(t,r),u=s.type.trim(),c=s.size,l=Y["parse_"+u]?Y["parse_"+u]:Y.parse_unknow;n.entries.push(l(t.subarray(r,r+c))),r+=c}return n.position=r,n},I=function(t){var n=f(t);return n.location=(0,a.str)(t,n.position,t.byteLength-n.position),n.position+=t.byteLength-n.position,n},O=function(t){var n=f(t),r=n.position;n.entry_count=(0,a.uint32)(t,r),r+=4,n.entries=[];for(var i=0;i<n.entry_count;i++){var o={};o.sample_count=(0,a.uint32)(t,r),r+=4,o.sample_delta=(0,a.uint32)(t,r),r+=4,n.entries.push(o)}return n.position=r,n},M=function(t){var n=f(t),r=n.position;n.entry_count=(0,a.uint32)(t,r),r+=4,n.entries=[];for(var i=0;i<n.entry_count;i++){var o={};o.sample_number=(0,a.uint32)(t,r),r+=4,n.entries.push(o)}return n.position=r,n},C=function(t){var n=f(t),r=n.position;if(n.entry_count=(0,a.uint32)(t,r),r+=4,0!=n.version)throw new Error("version equal to 1 is not implemented");n.entries=[];for(var i=0;i<n.entry_count;i++){var o={};o.sample_count=(0,a.uint32)(t,r),r+=4,o.sample_offset=(0,a.uint32)(t,r),r+=4,n.entries.push(o)}return n.position=r,n},P=function(t){var n=f(t),r=n.position;n.entry_count=(0,a.uint32)(t,r),r+=4,n.entries=[];for(var i=0;i<n.entry_count;i++){var o={};o.first_chunk=(0,a.uint32)(t,r),r+=4,o.samples_per_chunk=(0,a.uint32)(t,r),r+=4,o.sample_description_index=(0,a.uint32)(t,r),r+=4,n.entries.push(o)}return n.position=r,n},q=function(t){var n=f(t),r=n.position;if(n.sample_size=(0,a.uint32)(t,r),r+=4,n.sample_count=(0,a.uint32)(t,r),r+=4,0==n.sample_size){n.samples=[];for(var i=0;i<n.sample_count;i++){var o={};o.entry_size=(0,a.uint32)(t,r),r+=4,n.samples.push(o)}}return n.position=r,n},F=function(t){var n=f(t),r=n.position;n.entry_count=(0,a.uint32)(t,r),r+=4,n.entries=[];for(var i=0;i<n.entry_count;i++){var o={};o.chunk_offset=(0,a.uint32)(t,r),r+=4,n.entries.push(o)}return n.position=r,n},R=function(t){var n=f(t),r=n.position;return n.balance=parseFloat((0,a.uint8)(t,r)+"."+(0,a.uint8)(t,r+1)),r+=2,r+=2,n.position=r,n},V=function(t){var n=d(t);return n},N=3,B=4,H=5,W=6,$=function(t,n){var r={};return r.tag=n,r.data=new Uint8Array(t.byteLength),r.data.set(t,0),r},G={};G.Descriptor=$,G[N]=function(t,n){var r=0,i=(0,a.uint16)(t,r);r+=2;var o=(0,a.uint8)(t,r);r+=1;var s=0,u=null,c=0;if(128&o)throw new Error("not implemented");if(64&o)throw new Error("not implemented");if(32&o)throw new Error("not implemented");var f=J(t.subarray(r,t.byteLength));return r=t.byteLength,{tag:n,ES_ID:i,flags:o,dependsOn_ES_ID:s,url:u,ocr_ES_ID:c,descriptors:f,position:r,size:t.byteLength}},G[B]=function(t,n){var r=0,i=(0,a.uint8)(t,r);r+=1;var o=(0,a.uint8)(t,r);r+=1;var s=((0,a.uint8)(t,r)<<8)+(0,a.uint16)(t,r+1);r+=3;var u=(0,a.uint32)(t,r);r+=4;var c=(0,a.uint32)(t,r);r+=4;var f=J(t.subarray(r,t.byteLength));return r=t.byteLength,{tag:n,oti:i,stream_type:o,buffer_size:s,max_bitrate:u,avg_bitrate:c,descriptors:f,position:r,size:t.byteLength}},G[H]=$,G[W]=$;var J=function(t){for(var n=0,r=[];n<t.byteLength;){var i=(0,a.uint8)(t,n);n+=1;var o=(0,a.uint8)(t,n);n+=1;for(var s=0;128&o;)s=(127&o)<<7,o=(0,a.uint8)(t,n),n+=1;s+=127&o;var u;u=G[i]?G[i](t.subarray(n,n+s),i):G.Descriptor(t.subarray(n,n+s),i),r.push(u),n+=s}return r},X=function(t){console.log((0,i.hex)(t,","));var n=f(t),r=n.position;return n.descriptors=J(t.subarray(r,t.byteLength)),n.position=t.byteLength,console.log(n),n},Y={parse_unknow:m,parse_ftyp:h,parse_moov:g,parse_mvhd:v,parse_trak:y,parse_tkhd:_,parse_edts:b,parse_mdia:A,parse_elst:w,parse_mdhd:S,parse_hdlr:k,parse_minf:x,parse_vmhd:j,parse_dinf:D,parse_stbl:U,parse_smhd:R,parse_dref:E,parse_stsd:L,parse_stts:O,parse_stss:M,parse_ctts:C,parse_stsc:P,parse_stco:F,parse_stsz:q,parse_url:I,parse_avc1:z,parse_mp4a:V,parse_avcC:T,parse_esds:X};t.exports=Y},function(t,n,r){"use strict";var i=r(10),a=(r(8),function(t){return console.warn("generate unknow box type",t.type),t.data?(0,i.join)((0,i.uint32)(8+t.data.byteLength),(0,i.ascii_string)(t.type,4),t.data):(0,i.join)((0,i.uint32)(8),(0,i.ascii_string)(t.type,4))}),o=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=8+n.slice(1).map(function(t){return t.byteLength||0}).reduce(function(t,n){return t+n},0);return(0,i.join)((0,i.uint32)(a),(0,i.ascii_string)(n[0],4),i.join.apply(null,n.slice(1)))},s=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];if(n.length<3)throw new Error("fullbox need type, version and flag");var a=n[0],s=n[1],u=n[2];if(3!=u.length)throw new Error("flags must be an array contains 3 number");if(0!=s)throw new Error("version equal to 1 is not implemented");return o.call(null,a,new Uint8Array([s,u[0],u[1],u[2]]),i.join.apply(null,n.slice(3)))},u=function(t){var n=(0,i.ascii_string)(t.major_brand),r=(0,i.uint32)(t.minor_version),a=i.join.apply(null,t.compatible_brands.map(function(t){return(0,i.ascii_string)(t)})),s=o("ftyp",n,r,a);return s},c=function(t){var n=t.version,r=t.flag,a=t.create_time,o=t.modification_time,u=t.timescale,c=t.duration,f=t.matrix,l=t.next_track_ID,p=s("mvhd",n,r,(0,i.uint32)(a),(0,i.uint32)(o),(0,i.uint32)(u),(0,i.uint32)(c),new Uint8Array([0,1,0,0]),new Uint8Array([1,0]),new Uint8Array([0,0]),new Uint8Array([0,0,0,0,0,0,0,0]),f,new Uint8Array([0,0,0,0,0,0,0,0]),new Uint8Array([0,0,0,0,0,0,0,0]),new Uint8Array([0,0,0,0,0,0,0,0]),(0,i.uint32)(l));return p},f=function(t){var n=t.version,r=t.flag,a=t.create_time,o=t.modification_time,u=t.track_ID,c=t.duration,f=t.layer,l=t.alternate_group,p=t.volume,d=t.matrix,m=t.width,h=t.height,g=s("tkhd",n,r,(0,i.uint32)(a),(0,i.uint32)(o),(0,i.uint32)(u),new Uint8Array([0,0,0,0]),(0,i.uint32)(c),new Uint8Array([0,0,0,0,0,0,0,0]),(0,i.int16)(f),(0,i.int16)(l),p?new Uint8Array([1,0]):new Uint8Array([0,0]),d,(0,i.uint32)(m),(0,i.uint32)(h),new Uint8Array([0,0]));return g},l=function(t){var n=t.version,r=t.flag,a=t.entry_count,o=t.entries,u=s("elst",n,r,(0,i.uint32)(a),i.join.apply(null,o.map(function(t){var n=t.segment_duration,r=t.media_time,a=t.media_rate_integer,o=t.media_rate_fraction;return(0,i.join)((0,i.uint32)(n),(0,i.int32)(r),(0,i.int16)(a),(0,i.int16)(o))})));return u},p=function(t){var n=t.version,r=t.flag,a=t.create_time,o=t.modification_time,u=t.timescale,c=t.duration,f=s("mdhd",n,r,(0,i.uint32)(a),(0,i.uint32)(o),(0,i.uint32)(u),(0,i.uint32)(c),new Uint8Array([85,196,0,0]));return f},d=function(t){var n=t.version,r=t.flag,a=t.handler_type,o=t.name,u=s("hdlr",n,r,new Uint8Array([0,0,0,0]),(0,i.ascii_string)(a),new Uint8Array([0,0,0,0]),new Uint8Array([0,0,0,0]),new Uint8Array([0,0,0,0]),(0,i.ascii_string)(o));return u},m=function(t){var n=t.version,r=t.flag,a=t.graphicsmode,o=t.opcolor,u=s("vmhd",n,r,(0,i.uint16)(a),(0,i.uint16)(o[0]),(0,i.uint16)(o[1]),(0,i.uint16)(o[2]));return u},h=function(t){return i.join.apply(null,t.map(function(t){var n=W[t.type.trim()]?W[t.type.trim()]:a;return n(t)}))},g=function(t){var n=t.version,r=t.flag,a=t.entry_count,o=t.entries,u=s("dref",n,r,(0,i.uint32)(a),h(o));return u},v=function(t){var n=t.version,r=t.flag,a=t.location,o=s("url ",n,r,(0,i.ascii_string)(a));return o},y=function(t){var n=t.version,r=t.flag,a=t.entry_count,o=t.entries,u=s("stsd",n,r,(0,i.uint32)(a),h(o));return u},_=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];if(n.length<2)throw new Error("sample entry need type and data_reference_index");var a=n[0],s=n[1];return o.call(null,a,new Uint8Array([0,0,0,0,0,0]),(0,i.uint16)(s),i.join.apply(null,n.slice(2)))},b=function(t){var n=t.type,r=t.data_reference_index,a=t.width,o=t.height,s=t.horizresolution,u=t.vertresolution,c=t.frame_count,f=t.compressorname,l=t.depth,p=t.boxes,d=_(n,r,new Uint8Array([0,0]),new Uint8Array([0,0]),new Uint8Array([0,0,0,0]),new Uint8Array([0,0,0,0]),new Uint8Array([0,0,0,0]),(0,i.int16)(a),(0,i.int16)(o),(0,i.uint32)(s),(0,i.uint32)(u),new Uint8Array([0,0,0,0]),(0,i.uint16)(c),(0,i.ascii_string)(f,32),(0,i.uint16)(l),(0,i.int16)(-1),h(p));return d},w=function(t){var n=b(t);return n},A=function(t){var n=t.configurationVersion,r=t.AVCProfileIndication,a=t.profile_compatibility,s=t.AVCLevelIndication,u=t.lengthSizeMinusOne,c=t.numOfSequenceParameterSets,f=t.sequenceParameterSets,l=t.numOfPictureParameterSets,p=t.pictureParameterSets,d=o("avcC",(0,i.uint8)(n),(0,i.uint8)(r),(0,i.uint8)(a),(0,i.uint8)(s),(0,i.uint8)(252|u),(0,i.uint8)(224|c),i.join.apply(null,f.map(function(t){var n=t.sequenceParameterSetLength,r=t.sequenceParameterSetNALUnit;return(0,i.join)((0,i.uint16)(n),r)})),(0,i.uint8)(l),i.join.apply(null,p.map(function(t){var n=t.pictureParameterSetLength,r=t.pictureParameterSetNALUnit;return(0,i.join)((0,i.uint16)(n),r)})));return d},S=function(t){var n=t.version,r=t.flag,a=t.entry_count,o=t.entries,u=s("stts",n,r,(0,i.uint32)(a),i.join.apply(null,o.map(function(t){var n=t.sample_count,r=t.sample_delta;return(0,i.join)((0,i.uint32)(n),(0,i.uint32)(r))})));return u},k=function(t){var n=t.version,r=t.flag,a=t.entry_count,o=t.entries,u=s("ctts",n,r,(0,i.uint32)(a),i.join.apply(null,o.map(function(t){var n=t.sample_count,r=t.sample_offset;return(0,i.join)((0,i.uint32)(n),(0,i.uint32)(r));
})));return u},x=function(t){var n=t.version,r=t.flag,a=t.entry_count,o=t.entries,u=s("stsc",n,r,(0,i.uint32)(a),i.join.apply(null,o.map(function(t){var n=t.first_chunk,r=t.samples_per_chunk,a=t.sample_description_index;return(0,i.join)((0,i.uint32)(n),(0,i.uint32)(r),(0,i.uint32)(a))})));return u},U=function(t){var n=t.version,r=t.flag,a=t.sample_size,o=t.sample_count,u=t.samples,c=s("stsz",n,r,(0,i.uint32)(a),(0,i.uint32)(o),0==a?i.join.apply(null,u.map(function(t){var n=t.entry_size;return(0,i.uint32)(n)})):new Uint8Array(0));return c},L=function(t){var n=t.version,r=t.flag,a=t.entry_count,o=t.entries,u=s("stco",n,r,(0,i.uint32)(a),i.join.apply(null,o.map(function(t){var n=t.chunk_offset;return(0,i.uint32)(n)})));return u},z=function(t){var n=t.version,r=t.flag,a=t.fragment_duration,o=s("mehd",n,r,(0,i.uint32)(a));return o},T=function(t){var n=t.version,r=t.flag,a=t.track_ID,o=t.default_sample_description_index,u=t.default_sample_duration,c=t.default_sample_size,f=t.default_sample_flags,l=s("trex",n,r,(0,i.uint32)(a),(0,i.uint32)(o),(0,i.uint32)(u),(0,i.uint32)(c),(0,i.uint32)(f));return l},j=function(t){var n=t.version,r=t.flag,i=s("smhd",n,r,new Uint8Array([1,0]),new Uint8Array([0,0]));return i},D=function(t){var n=t.type,r=t.data_reference_index,a=t.channelcount,o=t.samplesize,s=t.samplerate,u=t.boxes,c=_(n,r,new Uint8Array([0,0,0,0]),new Uint8Array([0,0,0,0]),(0,i.uint16)(a),(0,i.uint16)(o),new Uint8Array([0,0]),new Uint8Array([0,0]),(0,i.uint32)(s),h(u));return c},E=function(t){var n=D(t);return n},I=3,O=4,M=5,C=6,P=function(t){var n=t.tag,r=t.data,a=(0,i.join)((0,i.uint8)(n),new Uint8Array([128,128,128]),new Uint8Array([r.byteLength]),r);return a},q={};q.Descriptor=P,q[I]=function(t){var n=t.tag,r=t.ES_ID,a=t.flags,o=t.descriptors;if(128&a)throw new Error("not implemented");if(64&a)throw new Error("not implemented");if(32&a)throw new Error("not implemented");var s=(0,i.join)((0,i.uint16)(r),(0,i.uint8)(a),F(o)),u=(0,i.join)((0,i.uint8)(n),new Uint8Array([128,128,128]),new Uint8Array([s.byteLength]),s);return u},q[O]=function(t){var n=t.tag,r=t.oti,a=t.stream_type,o=t.buffer_size,s=t.max_bitrate,u=t.avg_bitrate,c=t.descriptors,f=(0,i.join)((0,i.uint8)(r),(0,i.uint8)(a),(0,i.uint8)(o>>8),(0,i.uint16)(o%65535),(0,i.uint32)(s),(0,i.uint32)(u),F(c)),l=(0,i.join)((0,i.uint8)(n),new Uint8Array([128,128,128]),new Uint8Array([f.byteLength]),f);return l},q[M]=P,q[C]=P;var F=function(t){var n=t.map(function(t){var n=t.tag;return q[n]?q[n](t):P.Descriptor(t)});return i.join.apply(null,n)},R=function(t){var n=t.version,r=t.flag,i=t.descriptors,a=s("esds",n,r,F(i));return a},V=function(t){var n=t.version,r=t.flag,a=t.sequence_number,o=s("mfhd",n,r,(0,i.uint32)(a));return o},N=function(t){var n=t.version,r=t.flag,a=t.track_ID;if(2!=r[0]||0!=r[1]||0!=r[2])throw new Error("not implemented");var o=s("tfhd",n,r,(0,i.uint32)(a));return o},B=function(t){var n=t.version,r=t.flag,a=t.baseMediaDecodeTime,o=s("tfdt",n,r,(0,i.uint32)(a));return o},H=function(t){var n=t.version,r=t.flag,a=t.sample_count,o=t.data_offset,u=(t.first_sample_flags,t.samples);if(0!=r[0]||15!=r[1]||1!=r[2])throw new Error("not implemented");var c=s("trun",n,r,(0,i.uint32)(a),(0,i.int32)(o),i.join.apply(null,u.map(function(t){return(0,i.join)((0,i.uint32)(t.sample_duration),(0,i.uint32)(t.sample_size),(0,i.uint32)(t.sample_flags),(0,i.uint32)(t.sample_composition_time_offset))})));return c},W={box:o,ftyp:u,mvhd:c,tkhd:f,elst:l,mdhd:p,hdlr:d,vmhd:m,dref:g,stsd:y,stts:S,ctts:k,stsc:x,stsz:U,stco:L,mehd:z,trex:T,url:v,avc1:w,avcC:A,smhd:j,mp4a:E,esds:R,mfhd:V,tfhd:N,tfdt:B,trun:H};t.exports=W},function(t,n,r){"use strict";n.range=function(t,n,r){try{var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.setRequestHeader("Range","bytes="+n[0]+"-"+n[1]),i.onload=function(t){var n=i.response;if(n){var a=new Uint8Array(n);r(null,a)}else r(new Error("no response"))},i.send(null)}catch(a){r(a)}}},function(t,n){"use strict";function r(){this.isActive=!1,this.realtime=!1,this.chunkStart=0,this.chunkSize=0,this.totalLength=0,this.chunkTimeout=1e3,this.url=null,this.callback=null,this.eof=!1,this.setDownloadTimeoutCallback=null}var i={};i.info=console.log,r.prototype.setDownloadTimeoutCallback=function(t){return this.setDownloadTimeoutCallback=t,this},r.prototype.reset=function(){return this.chunkStart=0,this.totalLength=0,this.eof=!1,this},r.prototype.setRealTime=function(t){return this.realtime=t,this},r.prototype.setChunkSize=function(t){return this.chunkSize=t,this},r.prototype.setChunkStart=function(t){return this.chunkStart=t,this.eof=!1,this},r.prototype.setInterval=function(t){return this.chunkTimeout=t,this},r.prototype.setUrl=function(t){return this.url=t,this},r.prototype.setCallback=function(t){return this.callback=t,this},r.prototype.isStopped=function(){return!this.isActive},r.prototype.getFileLength=function(){return this.totalLength},r.prototype.getFile=function(){var t=this;if(t.totalLength&&this.chunkStart>=t.totalLength&&(t.eof=!0),t.eof===!0)return i.info("Downloader","File download done."),void this.callback(null,!0);var n=new XMLHttpRequest;n.open("GET",this.url,!0),n.responseType="arraybuffer";var r=null;n.start=this.chunkStart;var a;this.chunkStart+this.chunkSize<1/0&&(r="bytes="+this.chunkStart+"-",a=this.chunkStart+this.chunkSize-1,r+=a,n.setRequestHeader("Range",r)),n.onerror=function(e){t.callback(null,!1,!0)},n.onreadystatechange=function(e){if(404==n.status&&t.callback(null,!1,!0),(200==n.status||206==n.status||304==n.status||416==n.status)&&n.readyState==this.DONE){var r=n.getResponseHeader("Content-Range");if(i.info("Downloader","Received data range: "+r),!t.totalLength&&r){var a;a=r.indexOf("/"),a>-1&&(t.totalLength=+r.slice(a+1))}t.eof=n.response.byteLength!==t.chunkSize||n.response.byteLength===t.totalLength;var o=n.response;if(o.fileStart=n.start,o.fileStart||(o=o.slice(0),o.fileStart=n.start),t.callback(o,t.eof),t.isActive===!0&&t.eof===!1){var s=0;s=t.realtime?computeWaitingTimeFromBuffer(video):t.chunkTimeout,t.setDownloadTimeoutCallback&&t.setDownloadTimeoutCallback(s),i.info("Downloader","Next download scheduled in "+Math.floor(s)+" ms."),t.timeoutID=window.setTimeout(t.getFile.bind(t),s)}else t.isActive=!1}},t.isActive&&(i.info("Downloader","Fetching "+this.url+(r?" with range: "+r:"")),n.send())},r.prototype.start=function(){return i.info("Downloader","Starting file download"),this.chunkStart=0,this.resume(),this},r.prototype.resume=function(){return i.info("Downloader","Resuming file download"),this.isActive=!0,0===this.chunkSize&&(this.chunkSize=1/0),this.getFile(),this},r.prototype.stop=function(){return i.info("Downloader","Stopping file download"),this.isActive=!1,this.timeoutID&&(window.clearTimeout(this.timeoutID),delete this.timeoutID),this},t.exports=r}]);