<!DOCTYPE html>
<html>

  <head>
    <title>crossdomain.xml</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="/common/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/blog.css">
  </head>

  <body>
    <div class="blog-masthead">
      <div class="container">
        <nav class="blog-nav"><a href="/" class="blog-nav-item active">主页</a><a href="/posts" class="blog-nav-item">文章</a><a href="/tags" class="blog-nav-item">标签</a><a href="/projects" class="blog-nav-item">项目</a><a href="/about" class="blog-nav-item">关于</a></nav>
      </div>
    </div>
    <div class="container">
      <div class="blog-header">
        <h1 class="blog-title">小麦的二三事</h1>
        <p class="lead blog-description">他大舅他二舅，都是他舅</p>
      </div>
      <div class="col-sm-8 blog-main">
        <div class="row">
          <div class="blog-post">
            <h2 class="blog-post-title">crossdomain.xml</h2>
            <p class="blog-post-meta">写于2013年12月09日 关于<a href="/tags/Flash">Flash</a></p>
            <p><code>crossdomain.xml</code>是Flash授权一个客户端（Flash Player等）跨域访问数据的一个策略文件。当一个客户端请求不属于其所在域的资源时，远程服务器需要有一个<code>crossdomain.xml</code>文件去判断这个客户端所在的域是否有权限去访问这个资源。</p>
            <p>一个简单的<code>crossdomain.xml</code>的例子如下：</p> <pre><code>&lt;?xml version=&quot;1.0&quot;?&gt;    
&lt;!DOCTYPE cross-domain-policy SYSTEM &quot;http://www.adobe.com/xml/dtds/cross-domain-policy.dtd&quot;&gt;
&lt;cross-domain-policy&gt;
  &lt;site-control permitted-cross-domain-policies=&quot;master-only&quot;/&gt;
  &lt;allow-access-from domain=&quot;*.example.com&quot;/&gt;
  &lt;allow-access-from domain=&quot;www.example.com&quot;/&gt;
  &lt;allow-http-request-headers-from domain=&quot;*.adobe.com&quot; headers=&quot;SOAPAction&quot;/&gt;
&lt;/cross-domain-policy&gt;
</code></pre>
            <p>其根元素是<code>cross-domain-policy</code>，它可以包含以下几个子元素：</p>
            <ol>
              <li><code>site-control</code>，声明该域接受哪些策略文件。该元素只有一个特性，就是<code>permitted-cross-domain-policies</code>，它可以接受以下几个取值：
                <ol>
                  <li><code>none</code>，不接受任何策略文件，包括自己。</li>
                  <li><code>master-only</code>，只接受主策略文件，即定位在<code>http://your.domain/</code>的根下面的<code>crossdomain.xml</code>。</li>
                  <li><code>by-content-type</code>，所有<code>Content-Type</code>为<code>text/x-cross-domain-policy</code>都视为可接受的策略文件。</li>
                  <li><code>by-ftp-filename</code>，所有文件名为<code>crossdomain.xml</code>的都视为可接受的策略文件。</li>
                  <li><code>all</code>，所有策略文件都可以被接受。</li>
                </ol>
              </li>
              <li><code>allow-access-from</code>，声明这个域能被访问的策略。这个元素有以下几个特性：
                <ol>
                  <li><code>domain</code>，声明能访问这个域的域，例如上例的<code>*.example.com</code>。这个特性支持使用<code>*</code>作为通配符，例如<code>*</code>就代表所有域都可以访问这个域的资源。</li>
                  <li><code>to-ports</code>，只适用于Socket，表示允许从哪些端口访问，例如<code>10001,10002</code>。</li>
                  <li><code>secure</code>，只适用于HTTP，当这个特性的值为<code>true</code>的时候表示只允许使用HTTPS来访问这个域的资源。</li>
                </ol>
              </li>
              <li><code>allow-http-request-headers-from</code>，声明其它域能发送什么HTTP头。这个元素有以下几个特性：
                <ol>
                  <li><code>domain</code>，声明发送请求的域，与<code>allow-access-from</code>的<code>domain</code>特性类似。</li>
                  <li><code>headers</code>，声明能发送的HTTP头，如上例的<code>SOAPAction</code>。</li>
                  <li><code>secure</code>，与<code>allow-access-from</code>的<code>secure</code>特性类似。</li>
                </ol>
              </li>
            </ol>
            <p>最常用的用法就是在容器的根目录下面放置一个<code>crossdomain.xml</code>，根据我们的需要配置允许访问和允许发送请求的域。下面是两个极端的例子，第一个是最松散的策略：</p> <pre><code>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!DOCTYPE cross-domain-policy SYSTEM &quot;http://www.adobe.com/xml/dtds/cross-domain-policy.dtd&quot;&gt;
&lt;cross-domain-policy&gt;
  &lt;site-control permitted-cross-domain-policies=&quot;all&quot;/&gt;
  &lt;allow-access-from domain=&quot;*&quot; secure=&quot;false&quot;/&gt;
  &lt;allow-http-request-headers-from domain=&quot;*&quot; headers=&quot;*&quot; secure=&quot;false&quot;/&gt;
&lt;/cross-domain-policy&gt;
</code></pre>
            <p>接受所有策略文件、允许所有域的访问、允许向所有域发送请求。第二个是最严格的策略：</p> <pre><code>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!DOCTYPE cross-domain-policy SYSTEM &quot;http://www.adobe.com/xml/dtds/cross-domain-policy.dtd&quot;&gt;
&lt;cross-domain-policy&gt;
  &lt;site-control permitted-cross-domain-policies=&quot;none&quot;/&gt;
&lt;/cross-domain-policy&gt;
</code></pre>
            <p>所有策略文件都失效，包括自己。这种配置完了之后，就不能跨域访问这个域的资源了。</p>
            <nav class="pager">
              <li><a href="/posts/2013/12/08/hp-other-about-repaints-and-reflows.html" title="High Performance JavaScript 读书笔记之 还有一些关于Repaint和Reflow">上一篇</a></li>
              <li><a href="/posts/2013/12/10/flash-security-sandboxes.html" title="Flash安全性之安全沙箱">下一篇</a></li>
            </nav>
          </div>
        </div>
      </div>
      <div class="col-sm-3 col-sm-offset-1 blog-sidebar">
        <div class="sidebar-module">
          <h4>文章</h4>
          <ol class="list-unstyled">
            <li><a href="/posts/2014/02">2014年02月</a></li>
            <li><a href="/posts/2014/01">2014年01月</a></li>
            <li><a href="/posts/2013/12">2013年12月</a></li>
            <li><a href="/posts/2013/11">2013年11月</a></li>
            <li><a href="/posts/2013/10">2013年10月</a></li>
            <li><a href="/posts/2013/09">2013年09月</a></li>
            <li><a href="/posts/2013/08">2013年08月</a></li>
            <li><a href="/posts/2013/07">2013年07月</a></li>
            <li><a href="/posts/2013/01">2013年01月</a></li>
            <li><a href="/posts/2012/12">2012年12月</a></li>
          </ol>
        </div>
        <div class="sidebar-module">
          <h4>标签</h4>
          <ol class="list-unstyled">
            <li><a href="/tags/notes">notes(5)</a></li>
            <li><a href="/tags/css">css(23)</a></li>
            <li><a href="/tags/html">html(10)</a></li>
            <li><a href="/tags/JavaScript">JavaScript(106)</a></li>
            <li><a href="/tags/前端">前端(9)</a></li>
            <li><a href="/tags/jQuery">jQuery(29)</a></li>
            <li><a href="/tags/http">http(4)</a></li>
            <li><a href="/tags/node">node(3)</a></li>
            <li><a href="/tags/html5">html5(7)</a></li>
            <li><a href="/tags/Flash">Flash(30)</a></li>
          </ol>
        </div>
      </div>
    </div>
    <div class="container"></div>
    <footer class="blog-footer">
      <p>Powerby MaiZhiying</p>
    </footer>
  </body>

</html>