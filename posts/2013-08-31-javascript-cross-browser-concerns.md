---
layout: post
title: "Secrets of the JavaScript Ninja 读书笔记之 跨浏览器需要关心的东西"
description: ""
category: 
tags: [JavaScript]
---
{% include JB/setup %}

又到了周末读书的时间啦！今天带来跨浏览器编码需要关心的几个东西。

###浏览器的Bugs
____

其中一个最重要的点是我们需要了解，需要支持的数个浏览器中的bugs还有浏览器之间各种API的区别。完成代码的编写之后，最重要的是需要一套完整的测试用例，以便保证各种需要支持的浏览器上面不会出现问题。更重要的是我们需要持续进行测试，以防止浏览器更新之后的各种异常场景。

###修复浏览器的Bugs
____

要保证我们对于浏览器的Bugs的规避方法在浏览器修复对应Bugs之后还是可行的。更可靠的方式是做特性检测，而不是去做浏览器检测（检测会发生该bug的浏览器或者特定版本等）。

规避浏览器的bug可能会造成以下两个麻烦：

1. 规避的代码很容易在浏览器本身修复该bug之后失效。
2. 由于害怕浏览器修复bug之后的造成的麻烦，我们可能会停止催促浏览器厂商去修改这些bugs。

久而久之，会导致一些bug被当作是正确的使用方式，而真正正确的使用方式则被当作是“ bug”了。

而bug跟非标准的API也有区别。有时候我们为了向下兼容，会为低版本的浏览器自定义高版本浏览器对应的非标准API功能。这时候要注意，当浏览器升级之后，这些API的表现是否跟我们增加的API一致，因为这些非标准API什么时候都有可能改变的。相对的，浏览器的bug的修复是可遇见的，通常跟我们的预期是一致的。

###与外部代码共存
____

构建可重用的代码其中一个很重要的问题，就是如何与外部代码共存。一方面，我们自己编写的代码应该尽量避免影响外部代码的行为。另一方面，我们也要防止外部代码影响我们编写的代码的相关功能。

为了实现以上的目的，我们可以：

1. 使用闭包封装我们编写的代码。
2. 防止外部代码植入的属性，例如在`prototype`中新增的属性，在遍历的时候使用`hasOwnProperty`去避免遍历出这些别人新增的属性。

除了外部代码，有时候一些浏览器的特性也会造成困扰的问题，例如`form`元素会自动为其中每一个表单域创建一个名字是表单域的`name`特性的属性，这样会导致当一个`form`中有一个`name`为`submit`的表单元素，而调用`form.submit()`的时候，那个`submit`是一个表单域而不是提交方法。这个不算bug，也只能通过避免使用`form`的方法名来命名表单域来规避，虽然这也不是一件十分难的事情。

在编写一些与样式相关的代码时，要注意把样式写在脚本前面，才能保证脚本运行的时候样式已经被正确应用到HTML元素上面了。

###向下兼容
____

通常，为了兼容我们需要支持的浏览器中一些上一代的版本，我们需要编写向下兼容的代码，以保证在这些低版本浏览器上功能的可用性（可以牺牲一些效果或者效率）。通过优雅的降级，在低版本的浏览器中只保证基本功能正确。这样可以保证为百分之九十的用户提供良好的用户体验，而为百分之九的用户提供最基础的功能，还有忽略那百分之一的使用老旧浏览器的顽固用户。

有几个关键的点：

1. 不要为老的浏览器提供与新浏览器一样的用户体验，这样会很痛苦。
2. 保证所有需要支持的浏览器都提供完整的功能。
3. 假设未来的浏览器也能提供正确完整的功能。

###浏览器退化
____

浏览器bug、浏览器对非标准API的修改，都有可能使我们的代码失效。有一些浏览器的API修改是可以预见的，例如IE9提供的标准API`addEventLisener`等。这种修改对我们的代码不会造成任何影响。

更多的时候是一些未能预见的变更。这些问题只能通过无尽的测试才能预防了。最值得欣慰的一点是，浏览器厂商也会尽量避免这些退化行为，感谢上苍。
