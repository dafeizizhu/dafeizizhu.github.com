---
layout: post
title: "《JavaScript设计模式与开发实践》读书笔记"
description: ""
category: 
tags: [JavaScript, 读书笔记]
---

### 第10章 组合模式

组合模式局势用小的子对象来构建更大的对象，而这些小的子对象本身也许是由更小的“孙对象”构成的。

组合模式将对象组合成树形结构，以表示“部分-整体”的层次结构。除了用来表示树形结构之外，组合模式的另一个好处是通过对象的多态性表现，使得用户对单个对象和组合对象的使用具有一致性：

1. 提供了一种遍历树形结构的方案。
2. 利用对象的多态性表现，可以使客户端忽略组合对象和单个对象的不同。

请求在树中按照如下的规则传递：如果子节点是叶对象，叶对象自身会处理这个请求，而如果子节点还是组合对象，请求会继续往下传递。如果只是简单地遍历一组子节点，迭代器便能解决所有问题。组合模式用于处理比较复杂的树形结构。

在组合模式中，基本对象可以被组合成更复杂的组合对象，组合对象又可以被组合，这样不断递归下去，这棵树的结构可以支持任意多的复杂度。每当对最上层对象进行一次请求时，实际上是在对整个树进行深度优先的搜索。

在静态语言中，抽象类既代表组合对象，又代表叶对象，它也能够保证组合对象和叶对象拥有同样名字的方法，从而可以对同一个消息都做出反馈。

然而在JavaScript这种动态语言中，对象的多态性是与生俱来的，也没有编译器去检查变量的类型。JavaScript实现组合模式的难点在于要保证组合对象和叶对象拥有同样的方法，这通常需要用鸭子类型的思想对它们进行接口检查。

在使用组合模式的时候，需要注意：

1. 组合模式不是父子关系，是HAS-A（聚合）的关系，而不是IS-A。
2. 对叶对象操作的一致性。
3. 双向映射关系不能使用组合模式。
4. 用职责链模式提高组合模式的性能。

何时使用组合模式：

1. 表示对象的部分-整体层次结构。
2. 客户希望统一对待树中的所有对象。
