---
layout: post
title: "《JavaScript设计模式与开发实践》读书笔记"
description: ""
category: 
tags: [JavaScript, 读书笔记]
---

### 第20章 开放-封闭原则

开放-封闭原则的定义：软件实体（类、模块、函数）等应该是可以扩展的，但是不可修改的。

扩展函数功能的时候，用到两种方式：

1. 修改原有的代码。
2. 增加一段新的代码。

开放-封闭原则的思想：当需要改变一个程序的功能或者给这个程序增加新功能的时候，可以使用增加代码的方式，但是不允许改动程序的源代码。

相比修改源程序，如果通过增加几行代码就能解决问题，那这显然更简单和优雅，而且增加代码并不会影响原系统的稳定。

过多的条件分支语句是造成程序违反开放-封闭原则的一个常见原因。实际上，每当我们看到一大片的`if`或者`switch-case`语句时，第一时间就应该考虑，能否利用对象的多态性来重构它们。

利用多态的思想，我们把程序中不变的部分隔离出来，然后把可变的部分封装起来，这样一来程序就具有了可扩展性。遵守开放-封闭原则的规律，最明显的就是找出程序中将要发生变化的地方，然后把变化封装起来。

其他方式帮助我们编写遵守开放-封闭原则的方式：

1. 放置挂钩（hook）：我们在程序有可能发生变化的地方放置一个挂钩，挂钩的返回结果决定了程序的下一步走向。
2. 使用回调函数：我们可以把一部分易于变化的逻辑封装在回调函数里，然后把回调函数当作参数传入一个稳定和封闭的函数中。当回调函数执行的时候，程序就可以因为回调函数的内部逻辑不同，而产生不同的结果。

设计模式中的开放-封闭原则：

1. 发布-订阅模式：降低多个对象之间的依赖关系，取代对象之间硬编码的通知机制，一个对象不用再显式地调用另一个对象的某个接口。
2. 模板方法模式：把部分逻辑抽出来放到父类的模板方法里面，而子类的方法具体怎么实现则是可变的。通过增加新的子类，给系统增加新的功能，并不需要改动抽象父类以及其他子类。
3. 策略模式：策略和使用策略的客户代码可以分辨独立进行修改而互不影响。
4. 代理模式：不同的功能被隔离在两个函数里，它们可以单独改变而互不影响。
5. 职责链模式：当新增一个职责时，只需要增加一个职责节点，其他职责不受影响。

实际上，让程序保持完全封闭是不容易做到的。让程序符合开放-封闭原则的代价是引入更多的抽象层次，更多的抽象层次有可能会增加代码的复杂度。我们可以做到的有以下两点：

1. 挑出最容易发生变化的地方，然后构造抽象来封闭这些变化。
2. 在不可避免发生修改的时候，尽量修改那些相对容易修改的地方，例如配置文件等。

在当初编写代码的时候，先假设变化永远不会发生，这有利于我们迅速完成需求。当变化发生并且对我们接下来的工作造成影响的时候，可以再回头来封装这些变化的地方。

### 第21章 接口和面向接口的编程

通过主动暴露的接口来通信，可以隐藏软件系统内部的工作细节。Java中的`interface`可以产生一个完全抽象的类，用来表示一种契约，专门负责建立类和类之间的联系。

设计模式中的“接口”：接口是对象能响应的请求的集合。

静态类型语言通常设计成可以“向上转型”。当给一个类变量赋值时，这个变量的类型既可以使用这个类本身，也可以使用这个类的超类。通过向上转型，对象的具体类型被隐藏在“超类型”身后。当对象类型之间的耦合关系被解耦之后，这些对象才能在类型检查系统的监视下互相替换使用，这样才能看到对象的多态性。

抽象类的两个主要作用：

1. 向上转型。
2. 建立一些契约。帮助我们编写可靠性更高的代码。

不关注对象的具体类型，而仅仅针对超类型中的“契约方法”来编写程序，可以产生可靠性高的程序，也可以极大地减少子系统实现之间的相互依赖关系。这些契约行为暴露了一个类或者对象能够做什么，但是不关心具体如何去做。

`interface`的创建者确定方法名，参数列表和返回类型，这相当于提供一些行为上的约定，但不关心改行为的具体实现过程。`interface`同样可以用于向上转型，实现了同一个接口的两个类就可以被相互替换使用。

JavaScript是一门动态语言，类型本身在JavaScript中是一个相对模糊的概念。出了`number`、`string`、`boolean`等基本类型之外，其他对象都可以被看成“天生”被“向上转型”成了`Object`类型：

    Object ary = new Array()
    Object date = new Date()

接口在JavaScript中的最大作用就退化到了检查代码的规范性。

作为一门解释执行的动态类型语言，把希望寄托在编译器上是不可能了。如果要处理这类异常情况，我们只有手动编写一些接口检查的代码。

鸭子类型：如果两个对象拥有同样的方法，则有很大的可能性它们能够被相互替换使用。

### 第22章 代码重构

设计模式的目的就是为许多重构行为提供目标。

如果一个函数过长，不得不加上若干注释擦能让这个函数显得易读一些，那这些函数就很有必要进行重构。这样做的好处：

1. 避免出现超大函数。
2. 独立出来的函数有助于代码复用。
3. 独立出来的函数更容易被覆写。
4. 独立出来的函数如果拥有一个良好的命名，它本身就起到了注释的作用。

把条件分支语句提炼成一个单独的函数，既能更准确地表达代码的意思，函数名本身又能起到注释的作用。

如果有些代码实际上负责的是一些重复性的工作，那么合理利用循环不仅可以完成同样的功能，还可以使代码量更少。

如果对函数的剩余部分不感兴趣，那就应该立即退出。引到阅读者去看一些没有用的`else`片段，只会妨碍他们对程序的理解。于是我们可以挑选一些条件分支，在进入这些条件分支之后，就立即让这个函数退出。

我们可以把参数都放入一个对象内，函数需要的数据可以自行从该对象里获取，现在不用再关心参数的数量和顺序，只要保证参数对应的`key`值不变就可以了。

如果条件分支逻辑简单且清晰，可以使用三目运算符：

    var global = typeof window !== 'undefined' ? window : this

但如果条件分支逻辑非常复杂，那我们最好的选择还是按部就班地编写`if`、`else`。

链式调用（例如jQuery的选择器以及大部分API）带来的坏处就是在调试的时候非常不方便。因此如果该链条很容易发生变化，导致调试和维护困难，那么还是建议使用普通的调用形式。

在需要中止循环的时候直接退出整个方法。如果在循环后还有要执行的代码，可以放到`return`后面，如果代码较多，就应该把它们提炼成一个单独的函数。

（完）
