---
layout: post
title: "字符串的replace方法"
description: ""
category: 
tags: [JavaScript]
---
{% include JB/setup %}

`replace`是一个我们经常都会使用到的方法，最简单的就是直接使用字符串进行替换，还有就是可以传入正则表达式进行替换。不仅可以简单地替换字符串，而且还可以传入一个回调函数进行更复杂的替换。今天就简单看一下这个方法可以怎么用。

`replace`方法不会改变原来的字符串，它会返回一个替换后的新字符串。它接受两个参数，每个参数都有两种传入形式。

第一个参数可以是一个正则表达式，它匹配的结果会被第二个参数的返回值替换；也可以是一个字符串，原字符串中与这个字符串相同的子串会被第二个参数的返回值：

    "abca".replace("a", "d"); // "dbca"
    "abca".replace(/a/, "d"); // "dbca"

注意哦，如果第一个参数是字符串，则只会替换第一个相同的子串，如上例中的第二个`a`是没有被替换的，如果要替换全部相同的子串只能使用正则表达式：

    "abca".replace(/a/g, "d"); // "dbcd"

第二个参数比较有意思，它可以是一个字符串，作为新值被替换。这个字符串也简单支持了一些模式，例如：

1. `$$`，表示一个美元符号`$`。
2. `$&`，表示匹配的子串。
3. `$[反引号]`，表示匹配子串之前的子串。
4. `$'`，表示匹配子串之后的子串。
5. `$n`或者`$nn`，当`n`是一个数字的时候表示第n个捕获的子串，只有当第一个参数是正则表达式的时候才有效。

除了字符串，我们还可以指定一个回调函数作为第二个参数。`replace`会使用这个回调函数返回的值进行替换，例如：

    "abca".replace("b", function () { return "a";});
	// equals =>
    "abca".replace("b", "a");

这个回调函数接受可变长度的参数，可以分成四块：

1. `match`，匹配的子串，同字符串值`$&`。
2. `p1` ... `pn`，捕获的子串，有多少个捕获的子串就有多少个参数。
3. `offset`，倒数第二个参数表示匹配的子串在原字符串的偏移量。
4. `string`，原字符串。

例子：

    "abcdefg".replace(/(d)([^g]*)(g)/, function (match, 
      p1, p2, p3, offset, string) {
      console.log("match:", match); // defg
      console.log("p1:", p1); // d
      console.log("p2:", p2); // ef
      console.log("p3:", p3); // g
      console.log("offset:", offset); // 3
      console.log("string:", string); // abcdefg
    });

基本上`replace`已经非常灵活了，使用正则表达式和替换的回调函数几乎可以实现所有字符串替换的操作，赞！
