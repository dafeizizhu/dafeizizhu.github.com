---
layout: post
title: "React学习笔记之Thinking in React"
description: ""
category: 
tags: [JavaScript, React]
---

最近看别人的团队博客经常提到React这个框架。这个框架是一个面向视图的框架，所以它能跟市场上那些MV*框架良好的结合在一起。最重要的一点是React Native，能用JavaScript编写iOS的应用，而且使用者大都反馈性能比较好。所以本人也凑热闹学习一下，不然Mac Pro都白买了（o(╯□╰)o）。

简单写了几个官网上的教程，感觉`jsx`的语法还是可以适应的。其实学习React本身的语法应该是不难的，难的是观念：所有东西均为组件。在React中，应用是又大大小小的组件组成的，小至一个文本，大致一个复杂的图表，都是组件。React本身没有提供数据和视图的双向绑定，只提供了数据到视图的绑定。数据也分成两类，一类是属性，另一类是状态。问题来了，怎么区分一个数据项是属性还是状态呢？

首先我们应该把一个应用所涉及到的数据全部罗列粗来，以这个[React例子](http://maizhiying.github.io/projects/js/thinking-in-react/index.html)为例，其中的数据项有：

1. 产品列表
2. 搜索框中用户输入的文字
3. 多选框是否被选中
4. 经过搜索框过滤的产品列表

要区分这些数据是一个组件的属性或者是一个组件的状态，可以用下面3个问题来区分：

1. 这个数据是否从父组件里传过来的，如果是，这个数据项应该不是状态。
2. 这个数据是否随着时间变化，如果不是，这个数据项应该不是状态。
3. 这个数据是否能通过其他状态或者属性计算出来，如果是，这个数据应该不是状态。

根据这几个问题，可以大概得出：

1. 产品列表是通过属性传进来的，不是状态。
2. 搜索框中用户输入的问题，不是传进来的，也不能计算的，是状态。
3. 多选框是否被选中，同上，是状态。
4. 过滤的产品列表，是通过产品列表、输入框和多选框的值计算出来的，不是状态。

所以，对于例子中的顶层组件（应用），状态有：

1. 输入框中用户输入的文字。
2. 多选框是否被选中。

还有一个问题，像例子中顶层的两个状态，有两个子组件是需要使用的：

1. 搜索框需要显示过滤的文字和多选框的选中状态。
2. 产品列表需要根据过滤的文字和多选框的选择状态过滤产品列表。

那这些状态应该属于哪个组件呢？按照下列的步骤可以作简单的判断：

1. 把所有组件用到的状态值罗列出来。
2. 如果多个组件用到同样的状态值，那么寻找它们的共同祖先组件，例如列子中`SearchBar`和`ProductTable`的共同祖先组件为`FilterableProductTable`。
3. 这些状态就可以属于这个祖先组件，或者寻找这个祖先组件的上级去拥有这些状态。
4. 如果真心找不到一个组件，那么可以创建一个组件专门存储这些状态，让这个组件成为使用状态组件的子组件就可以了。
