---
layout: post
title: "《JavaScript设计模式与开发实践》读书笔记"
description: ""
category: 
tags: [JavaScript, 读书笔记]
---

### 第13章 职责链模式

职责链模式的定义是：使多个对象都有机会处理请求，从而避免请求的发送者和接受者之间的耦合关系，将这些对象连成一条链，并沿着这条链传递该请求，直到有一个对象处理它为止。

职责链模式最大的优点：请求发送者只需要知道链中第一个节点，从而弱化了发送者和一组接收者之间的强联系。

灵活可拆分的职责链模式：我们约定，如果某个节点不能处理请求，则返回一个特定的字符串来表示该请求需要继续往后传递。请求在链中的节点传递，但节点有权利决定什么时候把请求交给下一个节点。

职责链模式的优点：

1. 每个节点都有各自的处理函数互不影响。
2. 链中的节点对象可以灵活地拆分重组。
3. 可以手动指定起始节点，请求并不是非得从链中的第一个节点开始传递。

一般地，我们可以在链尾增加一个保底的接收者来处理这种即将离开链尾的请求。

另外，职责链模式使得程序中多了一些节点对象，可能在某一次请求传递过程中，大部分节点并没有起到实质性的作用，它们的作用仅仅是让请求传递下去，从性能方面考虑，我们要避免过长的职责链带来的性能损耗。

用AOP来实现职责链：

    Function.prototype.after = function (fn) {
      var self = this
      return function () {
        var ret = self.apply(this, arguments)
        if (ret == 'nextSuccessor') {
          return fn.apply(this, arguments)
        }
        return ret
      }
    }

    var order = order500yuan.after(order200yuan).after(orderNormal)

    order(1, true, 500)

用AOP来实现职责链既简单又巧妙，但这种把函数叠在一起的方式，同时也叠加了函数的作用域，如果链条太长的话，也会对性能有较大的影响。
