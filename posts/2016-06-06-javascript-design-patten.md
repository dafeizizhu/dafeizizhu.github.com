---
layout: post
title: "《JavaScript设计模式与开发实践》读书笔记"
description: ""
category: 
tags: [JavaScript, 读书笔记]
---

### 第12章 享元模式

享元模式是一种用于性能优化的模式，核心是运用共享技术来有效支持大量细粒度的对象。享元模式可以很好地解决大量对象带来的性能问题。

享元模式要求将对象的属性划分为内部状态与外部状态（状态在这里通常指属性）。享元模式的目标是尽量减少共享对象的数量。

如何划分：

1. 内部状态存储于对象的内部。
2. 内部状态可以被一些对象共享。
3. 内部状态独立于具体的场景，通常不会改变。
4. 外部状态取决于具体的场景，并根据场景而变化，外部状态不能被共享。

我们可以把所有内部状态相同的对象都指定为同一个共享的对象。而外部状态可以从对象身上剥离出来，并存储在外部。

外部状态在必要时被传入共享对象来组装成一个完整的对象。享元模式是一种用时间换空间的优化模式。

通常来讲，内部状态有多少种组合，系统中便最多存在多少个对象。

使用享元模式的关键是如何区别内部状态和外部状态。

只有当某种共享状态被真正需要时，它才从工厂中被创建出来。用一个管理器来记录对象相关的外部状态，使这些外部状态通过某个钩子和共享对象联系起来。

使用享元模式之后，我们需要分别多维护一个factory对象和一个manager对象，在大部分不必要使用享元模式的环境下，这些开销是可以避免的。

一般来说，以下情况发生时便可以使用享元模式：

1. 一个程序中使用了大量的相似对象。
2. 由于使用了大量对象，造成很大的内存开销。
3. 对象的大多数状态都可以变为外部状态。
4. 剥离出对象的外部状态之后，可以用相对较少的共享对象取代大量对象。

当对象没有内部状态的时候，生产共享对象的工厂实际上变成一个单例工厂。

对象池维护一个装载空闲对象的池子，如果需要对象的时候，不是直接new，而是转从对象池中获取。如果对象池里没有空闲对象，则创建一个新的对象，当获取出的对象完成它的职责之后，再进入池子等待被下次获取。
